<!DOCTYPE html>
<html>
<head>
  <title>好運控</title>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">

  <link rel="shortcut icon" href="images/fav.png" type="image/x-icon">
  <link rel="apple-touch-icon" href="images/fav.png">
  <link rel="apple-touch-icon" sizes="76x76" href="images/fav.png">
  <link rel="apple-touch-icon" sizes="120x120" href="images/fav.png">
  <link rel="apple-touch-icon" sizes="152x152" href="images/fav.png">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">

  <link rel="stylesheet" href="stylesheets/style.css?t=1559">
</head>

<body class="cursor-pointer">
  <!-- <div class="flex justify-center my-20">
    <div id="clickme" class="cursor-pointer text-xl border-2 border-black px-3 transition-all shadow-[4px_4px_0px_#000] hover:shadow-none hover:translate-y-1 hover:translate-x-1">CLICK ME</div>
  </div> -->

  <div class="flex">
    <section class="flex border-[5px] border-black divide-x-[5px] divide-black" v-scope="{
      posts: [
        {
          id: 1,
          pic: `images/item-1.png`,
          title: `1`,
        },{
          id: 2,
          pic: `images/item-2.png`,
          title: `2`,
        },{
          id: 3,
          pic: `images/item-3.png`,
          title: `3`,
        },{
          id: 4,
          pic: `images/item-4.png`,
          title: `4`,
        },{
          id: 5,
          pic: `images/item-5.png`,
          title: `5`,
        },
      ],
    }" v-on:vue:mounted="tigerHandler($el)">
      <!-- 這是一條 -->
      <div v-for="p,i in 3" class="tiger aspect-[1/4] h-[1920px] overflow-hidden">
        <ul>
          <li v-for="p,i in posts" :data-id="p.id" class="h-[640px] flex flex-col items-center justify-center h-1/3 will-change-transform">
            <div class="p-5 relative h-[77%]">
              <img :src="p.pic" class="img-contain">
            </div>

            <div class="font-medium text-[30px] border-2 border-black rounded-full px-3 pb-px">{{p.title}}</div>
          </li>
        </ul>
      </div>
    </section>
  </div>
</body>

<script src="js/jquery.min.js"></script>
<script src="js/petite-vue.js" defer init></script>
<script src="js/gsap.min.js"></script>
</html>

<script>
  function tigerHandler(el) {
    $(".tiger", el).each(function (i, el) {
      let $ul = $("ul", el)
      let $li = $("li", el)

      // 隨機排序 li
      const liArray = $li.toArray(); // 轉為陣列
      for (let i = liArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1)); // 隨機索引
        [liArray[i], liArray[j]] = [liArray[j], liArray[i]]; // 交換
      }
      // 清空 ul 並重新附加隨機排序的 li
      $ul.empty().append(liArray);

      $ul.clone().appendTo(el)
    })
  }


  $(window).on("load", function () {
    $("body").on("click", function () {
      // 從1開始
      let end = ~~gsap.utils.random(1, 6)

      $(".tiger").each(function (i, item) {
        const h = $("li", item).first().outerHeight(true)
        const total = $("ul", item).first().children().length
        const totalHeight = $("ul", item).first().outerHeight(true)
        const targetIndex = 1
        const loop = 6


        let final

        $("ul", item).first().children().each(function (i, li) {
          let id = li.dataset.id
          if (id == end) {
            final = i
          }
        })

        let baseY = - (final - targetIndex) * h


        gsap.to($("ul", item), {
          delay: i * 0.2,
          duration: 3,
          y: baseY - loop * totalHeight,
          modifiers: {
            y: (y) => {
              // 將 y 值限制在一個週期內，實現無縫循環
              return (parseFloat(y) % totalHeight) + "px";
            }
          },
          ease: 'power2.inOut',
        })
      })
    })
  })
</script>